/**
 * Responsive carousel fit for asynchronous data
 * @version v0.0.2 - 2015-09-08
 * @link https://github.com/blakeandrewwood/angular-carousel-lite#readme
 * @author Blake Wood
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angularCarouselLite",[]),angular.module("angularCarouselLite").directive("carouselLite",["$timeout",function(a){return{restrict:"E",scope:{carouselClass:"=carouselClass",slideClass:"=slideClass"},link:function(b,c,d){function e(){f(),g(),i()}function f(){c.append('<div id="carousel" class="'+D+'"></div>'),B=$("#carousel"),B.css({position:"relative","background-color":"#fff",cursor:"pointer","overflow-x":"hidden","overflow-y":"hidden"})}function g(){B.append('<div id="carousel-track"></div>'),C=$("#carousel-track"),C.css({position:"absolute",top:"0",left:"0",height:"100%","white-space":"nowrap","box-sizing":"border-box"})}function h(){A&&a.cancel(A),A=a(function(){G.numSlides>0&&p(G.position)},250)}function i(){F=Math.floor(window.innerWidth/2),j()}function j(){var a=window.innerWidth,b=(C.outerWidth(),a+200);C.css("padding-left",b+"px"),C.css("padding-right",b+"px")}function k(b){l(b,function(){G.numSlides++,m(b),x(b),1==G.numSlides&&a(function(){G.position=0,p(0)},800)})}function l(a,b){var c=new Image;c.src=a,c.callback=b,c.onload=function(){this.callback()}}function m(a){var b="";b+='<div class="carousel-image '+E+'">',a&&(b+='<img style="height: 100%;" draggable="false" src="'+a+'">'),b+="</div>",C.append(b);var c=$(".carousel-image:last");c.css({display:"inline-block",position:"relative",top:"0",left:"0",height:"100%","vertical-align":"top","pointer-events":"none","box-sizing":"border-box"});var d=(c.position(),c.offset(),c.outerWidth()),e=c.outerHeight(),f=d/2,g=e/2;c.find(".image-center:first").css({top:g-40,left:f-40})}function n(){G.numSlides>0&&G.position<G.numSlides-1&&(G.position++,p(G.position,"next"))}function o(){G.position>0&&(G.position--,p(G.position,"prev"))}function p(a,b){var c=s(G.position);t(c,b)}function q(a){B.scrollLeft(a)}function r(a){var b=[],c=[];$(".carousel-image").each(function(){var a=$(this),d=u(a);d>0?b.push(d):c.push(d)});var d=Array.absMin(b),e=Array.absMin(c),f=d>e?-e:d,g=d>e?"prev":"next",h=a-f;console.log({nearest:f,minPos:d,minNeg:e,difference:h}),d>e?(g="prev",G.position--):e>d&&(g="next",G.position++);var i=B.scrollLeft()+f;t(i,g)}function s(a){var b=$(".carousel-image").eq(a),c=u(b);return B.scrollLeft()+c}function t(a,b){v(b),B.animate({scrollLeft:a},100,function(){w(b)})}function u(a){var b=a.offset().left+a.outerWidth()/2;return b-F}function v(a){G.lastPosition=G.position-1,y(a)}function w(a){z(a)}function x(a){b.$emit("carouselEventImageLoaded",{src:a})}function y(a){b.$emit("carouselEventPreScroll",{position:G.lastPosition,direction:a})}function z(a){b.$emit("carouselEventPostScroll",{position:G.position,direction:a})}var A,B,C,D=d.carouselClass,E=d.slideClass,F=0,G={position:-1,lastPosition:-1,numSlides:0},H={button:null,grabbed:{x:0},scroll:{x:0},start:{x:0}};e(),$(window).resize(function(){i(),h()}),Array.absMin=function(a){return Math.min.apply(Math,a.map(Math.abs))},C.mousedown(function(a){0===a.button?(H.button=0,H.grabbed.x=a.pageX,H.start.x=B.scrollLeft()):H.button=null}),$(document).mouseup(function(a){H.button=null}),C.mouseup(function(a){r(F)}),C.mousemove(function(a){if(0===H.button){var b=a.pageX;H.scroll.x=B.scrollLeft(),H.distance=H.start.x-b+H.grabbed.x,q(H.distance)}}),b.$on("carouselAdd",function(a,b){k(b.image)}),b.$on("carouselNext",function(a,b){n()}),b.$on("carouselPrev",function(a,b){o()})}}}]);