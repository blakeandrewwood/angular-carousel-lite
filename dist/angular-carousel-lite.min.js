/**
 * Responsive carousel fit for asynchronous data
 * @version v0.0.2 - 2015-09-08
 * @link https://github.com/blakeandrewwood/angular-carousel-lite#readme
 * @author Blake Wood
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angularCarouselLite",[]),angular.module("angularCarouselLite").directive("carouselLite",["$timeout",function(a){return{restrict:"E",scope:{carouselClass:"=carouselClass",slideClass:"=slideClass"},link:function(b,c,d){function e(){f(),g(),i()}function f(){c.append('<div id="carousel" class="'+F+'"></div>'),D=$("#carousel"),D.css({position:"relative","background-color":"#fff",cursor:"pointer","overflow-x":"hidden","overflow-y":"hidden"})}function g(){D.append('<div id="carousel-track"></div>'),E=$("#carousel-track"),E.css({position:"absolute",top:"0",left:"0",height:"100%","white-space":"nowrap","box-sizing":"border-box"})}function h(){C&&a.cancel(C),C=a(function(){I.numSlides>0&&p(I.position)},250)}function i(){H=Math.floor(window.innerWidth/2),j()}function j(){var a=window.innerWidth,b=(E.outerWidth(),a+200);E.css("padding-left",b+"px"),E.css("padding-right",b+"px")}function k(b){l(b,function(){I.numSlides++,m(b),z(b),1==I.numSlides&&a(function(){I.lastScroll.x=-9999,p(0)},800)})}function l(a,b){var c=new Image;c.src=a,c.callback=b,c.onload=function(){this.callback()}}function m(a){var b="";b+='<div class="carousel-image '+G+'">',a&&(b+='<img style="height: 100%;" draggable="false" src="'+a+'">'),b+="</div>",E.append(b);var c=$(".carousel-image:last");c.css({display:"inline-block",position:"relative",top:"0",left:"0",opacity:"0.5",height:"100%","vertical-align":"top","pointer-events":"none","box-sizing":"border-box"});var d=(c.position(),c.offset(),c.outerWidth()),e=c.outerHeight(),f=d/2,g=e/2;c.find(".image-center:first").css({top:g-40,left:f-40})}function n(){if(I.numSlides>0&&I.position<I.numSlides-1){var a=I.position+1;p(a)}}function o(){if(I.position>0){var a=I.position-1;p(a)}}function p(a){var b=s(a);v(b)}function q(a){D.scrollLeft(a)}function r(a){var b=[],c=[];$(".carousel-image").each(function(){var a=$(this),d=w(a);d>0?b.push(d):c.push(d)});var d=Array.absMin(b),e=Array.absMin(c),f=d>e?-e:d,g=D.scrollLeft()+f;v(g)}function s(a){var b=$(".carousel-image").eq(a),c=w(b);return D.scrollLeft()+c}function t(){var a=$(".carousel-image").eq(I.lastPosition);a.css("opacity","0.5");var b=$(".carousel-image").eq(I.position);b.css("opacity","1")}function u(){var a="none";return I.lastPosition=I.position,I.lastScroll.x<D.scrollLeft()?(a="next",I.position++):I.lastScroll.x>D.scrollLeft()&&(a="prev",I.position--),a}function v(a){x(),D.animate({scrollLeft:a},100,function(){var a=u();y(a)})}function w(a){var b=a.offset().left+a.outerWidth()/2;return b-H}function x(){t(),A()}function y(a){I.lastScroll.x=D.scrollLeft(),B(a)}function z(a){b.$emit("carouselEventImageLoaded",{src:a})}function A(){b.$emit("carouselEventPreScroll",{})}function B(a){b.$emit("carouselEventPostScroll",{position:I.position,direction:a})}var C,D,E,F=d.carouselClass,G=d.slideClass,H=0,I={position:-1,lastPosition:-1,numSlides:0,lastScroll:{x:0}},J={button:null,grabbed:{x:0},scroll:{x:0},start:{x:0}};e(),$(window).resize(function(){i(),h()}),Array.absMin=function(a){return Math.min.apply(Math,a.map(Math.abs))},E.mousedown(function(a){0===a.button?(J.button=0,J.grabbed.x=a.pageX,J.start.x=D.scrollLeft()):J.button=null}),$(document).mouseup(function(a){J.button=null}),E.mouseup(function(a){r(H)}),E.mousemove(function(a){if(0===J.button){var b=a.pageX;J.scroll.x=D.scrollLeft(),J.distance=J.start.x-b+J.grabbed.x,q(J.distance)}}),b.$on("carouselAdd",function(a,b){k(b.image)}),b.$on("carouselNext",function(a,b){n()}),b.$on("carouselPrev",function(a,b){o()})}}}]);